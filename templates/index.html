<!DOCTYPE html>
<html>
<head>
    <title>Web Push Notifications</title>
    <script src="serviceWorker.js"></script>
</head>
<body>
    <h1>웹 푸시 알림</h1>
    <button id="subscribeButton">구독하기</button>
    <button id="unsubscribeButton" disabled>구독 취소</button>
    <div id="notification"></div>

    <script>
        const subscribeButton = document.getElementById('subscribeButton');
        const unsubscribeButton = document.getElementById('unsubscribeButton');
        const notification = document.getElementById('notification');

        // 구독 요청 함수
        function subscribe() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('serviceWorker.js')
                    .then(function(registration) {
                        registration.pushManager.subscribe()
                            .then(function(subscription) {
                                console.log('Endpoint:', subscription.endpoint);
                                // 구독 정보 백엔드 서버에 전송
                                sendSubscriptionToServer(subscription);
                                updateSubscriptionUI(true);
                            })
                            .catch(function(error) {
                                console.error('Failed to subscribe:', error);
                            });
                    })
                    .catch(function(error) {
                        console.error('Failed to register service worker:', error);
                    });
            } else {
                console.error('Push API is not supported');
            }
        }

        // 구독 취소 요청 함수
        function unsubscribe() {
            navigator.serviceWorker.ready.then(function(registration) {
                registration.pushManager.getSubscription()
                    .then(function(subscription) {
                        if (subscription) {
                            subscription.unsubscribe()
                                .then(function() {
                                    console.log('Subscription successfully unsubscribed');
                                    sendUnSubscriptionToServer(); // 백엔드 서버에 알림
                                    updateSubscriptionUI(false);
                                })
                                .catch(function(error) {
                                    console.error('Failed to unsubscribe:', error);
                                });
                        } else {
                            console.log('User is not subscribed');
                        }
                    })
                    .catch(function(error) {
                        console.error('Failed to get subscription:', error);
                    });
            });
        }

        // 구독 여부에 따라 UI 업데이트
        function updateSubscriptionUI(isSubscribed) {
            if (isSubscribed) {
                subscribeButton.disabled = true;
                unsubscribeButton.disabled = false;
            } else {
                subscribeButton.disabled = false;
                unsubscribeButton.disabled = true;
            }
        }

        // 구독 정보 백엔드 서버에 전송
        function sendSubscriptionToServer(subscription) {
            // 실제 구현은 서버 API와 연동해야 함
            console.log('Subscription information:', subscription);
        }

        // 구독 취소 정보 백엔드 서버에 전송
        function sendUnSubscriptionToServer() {
            // 실제 구현은 서버 API와 연동해야 함
            console.log('Unsubscription information');
        }

        // 구독 버튼 클릭 시 구독 요청
        subscribeButton.addEventListener('click', subscribe);

        // 구독 취소 버튼 클릭 시 구독 취소 요청
        unsubscribeButton.addEventListener('click', unsubscribe);
